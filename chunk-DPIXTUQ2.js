import{b as I,c as g,d as C,e as y,h as j,j as w,k as L,r as N,t as T}from"./chunk-OAJHFRGD.js";import{O as n,U as v,Xa as h,Y as c,bb as _,fa as s,ga as r,gb as E,ha as i,ia as d,lb as x,na as f,nb as S,oa as u,p as b,ub as F,xa as l,z as m,za as p}from"./chunk-4YEZQ5FG.js";import"./chunk-KAT7YFEL.js";function R(e,a){if(e&1&&(r(0,"div",17),l(1),i()),e&2){let o=u();n(),p(" ",o.mensajeExito," ")}}function A(e,a){e&1&&(r(0,"span"),l(1," El email es obligatorio "),i())}function D(e,a){e&1&&(r(0,"span"),l(1," El email no es v\xE1lido "),i())}function O(e,a){if(e&1&&(r(0,"small",18),c(1,A,2,0,"span",19)(2,D,2,0,"span",19),i()),e&2){let o=u();n(),s("ngIf",o.loginForm.controls.email.errors==null?null:o.loginForm.controls.email.errors.required),n(),s("ngIf",o.loginForm.controls.email.errors==null?null:o.loginForm.controls.email.errors.email)}}function P(e,a){e&1&&(r(0,"small",18),l(1," La contrase\xF1a es obligatoria "),i())}function q(e,a){if(e&1&&(r(0,"div",20),l(1),i()),e&2){let o=u();n(),p(" ",o.mensajeError," ")}}var k=class e{submitted=!1;loading=!1;mensajeError="";mensajeExito="";cdr=m(h);fb=m(N);authService=m(F);router=m(S);route=m(x);loginForm=this.fb.nonNullable.group({email:["",[g.required,g.email]],password:["",g.required]});ngOnInit(){if(this.authService.isLoggedIn()){this.router.navigate(["/productos"]);return}this.route.queryParams.subscribe(a=>{a.registrado==="ok"&&(this.mensajeExito="Registro exitoso. Ya pod\xE9s iniciar sesi\xF3n.")})}loguearse(){if(this.submitted=!0,this.loginForm.markAllAsTouched(),this.mensajeError="",this.loginForm.invalid){this.mensajeError="Complet\xE1 correctamente los campos.",this.cdr.detectChanges();return}this.loading=!0;let{email:a,password:o}=this.loginForm.getRawValue();this.authService.login(a,o).pipe(b(()=>{this.loading=!1,this.cdr.detectChanges()})).subscribe({next:()=>{this.router.navigate(["/productos"])},error:t=>{t.status===0?this.mensajeError="No se pudo conectar con el servidor. Intentalo m\xE1s tarde.":t.status===401||t.status===403?this.mensajeError="Mail o contrase\xF1a incorrectos.":this.mensajeError="Ocurri\xF3 un error inesperado.",this.cdr.detectChanges()}})}irARegistro(){this.router.navigate(["/registro"])}static \u0275fac=function(o){return new(o||e)};static \u0275cmp=v({type:e,selectors:[["app-login"]],decls:26,vars:7,consts:[[1,"container","mt-5"],[1,"row","justify-content-center"],[1,"col-md-6","col-lg-5"],[1,"card","shadow"],[1,"card-body","p-4"],[1,"text-center","mb-3"],["src","assets/img/lisemma-logo.png","alt","Lissema",1,"logo"],[1,"text-center","mb-4","titulo"],["class","alert alert-success",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"mb-3"],["type","email","formControlName","email","placeholder","nombre@ejemplo.com",1,"form-control"],["class","text-danger",4,"ngIf"],["type","password","formControlName","password","placeholder","Ingres\xE1 tu contrase\xF1a",1,"form-control"],["type","submit",1,"btn","btn-primary","w-100","boton",3,"disabled"],["class","alert alert-danger mt-3",4,"ngIf"],["type","button",1,"btn","btn-primary","w-100","botonSecundario","mt-3",3,"click"],[1,"alert","alert-success"],[1,"text-danger"],[4,"ngIf"],[1,"alert","alert-danger","mt-3"]],template:function(o,t){o&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),d(6,"img",6),i(),r(7,"h3",7),l(8,"Iniciar Sesi\xF3n"),i(),c(9,R,2,1,"div",8),r(10,"form",9),f("ngSubmit",function(){return t.loguearse()}),r(11,"div",10)(12,"label"),l(13,"Email"),i(),d(14,"input",11),c(15,O,3,2,"small",12),i(),r(16,"div",10)(17,"label"),l(18,"Contrase\xF1a"),i(),d(19,"input",13),c(20,P,2,0,"small",12),i(),r(21,"button",14),l(22),i(),c(23,q,2,1,"div",15),i(),r(24,"button",16),f("click",function(){return t.irARegistro()}),l(25," Ir a Registro "),i()()()()()()),o&2&&(n(9),s("ngIf",t.mensajeExito),n(),s("formGroup",t.loginForm),n(5),s("ngIf",(t.loginForm.controls.email.touched||t.submitted)&&t.loginForm.controls.email.invalid),n(5),s("ngIf",(t.loginForm.controls.password.touched||t.submitted)&&t.loginForm.controls.password.invalid),n(),s("disabled",t.loading),n(),p(" ",t.loading?"Ingresando...":"Iniciar sesi\xF3n"," "),n(),s("ngIf",t.mensajeError))},dependencies:[E,_,T,j,I,C,y,L,w],styles:[".boton[_ngcontent-%COMP%]{background-color:#38b6ff;border-color:#38b6ff;font-weight:600}.boton[_ngcontent-%COMP%]:hover{background-color:#1aa8ff;border-color:#1aa8ff}.botonSecundario[_ngcontent-%COMP%]{background-color:#f90000;border-color:#f90000;font-weight:600}.botonSecundario[_ngcontent-%COMP%]:hover{background-color:#e60000;border-color:#e60000}"]})};export{k as Login};
