import{a as U}from"./chunk-64X3PJ43.js";import{a as Z}from"./chunk-KKWSRWCR.js";import{a as X}from"./chunk-ODID5PJH.js";import"./chunk-FK6H3RFT.js";import{a as Q}from"./chunk-HSY23XSR.js";import{b as x,d as k,e as V,f as L,g as w,h as O,i as A,p as K,q as B,s as I}from"./chunk-OAJHFRGD.js";import{A as C,B as v,Ba as m,Ca as p,Da as g,F as N,L as j,La as S,Na as y,O as d,U as P,Xa as W,Y as D,ab as R,bb as H,eb as Y,fa as f,fb as J,ga as t,gb as M,ha as r,ia as $,ma as E,na as s,oa as _,va as G,xa as n,ya as F,z as h,za as b}from"./chunk-4YEZQ5FG.js";import"./chunk-KAT7YFEL.js";var q=class c{cerrar=new N;productoService=h(U);nombre="";categoriaId=null;costoUnitario=null;precioUnitario=null;stock=null;guardando=!1;guardar(){if(this.guardando)return;this.guardando=!0;let a={nombre:this.nombre,categoriaId:this.categoriaId??void 0,costoUnitario:this.costoUnitario??0,precioUnitario:this.precioUnitario??0,stock:this.stock??0};this.productoService.agregarProducto(a).subscribe({next:()=>{this.productoService.cargarProductos(),this.cerrar.emit(),this.guardando=!1},error:i=>{console.error("Error al agregar:",i),this.guardando=!1}})}cerrarModal(){this.cerrar.emit()}static \u0275fac=function(i){return new(i||c)};static \u0275cmp=P({type:c,selectors:[["app-agregar-producto"]],outputs:{cerrar:"cerrar"},decls:25,vars:7,consts:[[1,"overlay",3,"click"],[1,"modal-card"],[1,"text-center","mb-3"],[3,"ngSubmit","keydown.enter"],[1,"form-label"],["type","text","name","nombre","required","",1,"form-control","mb-2",3,"ngModelChange","ngModel"],["type","number","name","categoriaId",1,"form-control","mb-2",3,"ngModelChange","ngModel"],["type","number","name","costo","required","",1,"form-control","mb-2",3,"ngModelChange","ngModel"],["type","number","name","precio","required","",1,"form-control","mb-2",3,"ngModelChange","ngModel"],["type","number","name","stock",1,"form-control","mb-3",3,"ngModelChange","ngModel"],[1,"d-flex","justify-content-between","mt-3"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-success",3,"disabled"]],template:function(i,e){i&1&&(t(0,"div",0),s("click",function(){return e.cerrarModal()}),r(),t(1,"div",1)(2,"h3",2),n(3,"Agregar nuevo producto"),r(),t(4,"form",3),s("ngSubmit",function(){return e.guardar()})("keydown.enter",function(o){return o.preventDefault()}),t(5,"label",4),n(6,"Nombre"),r(),t(7,"input",5),g("ngModelChange",function(o){return p(e.nombre,o)||(e.nombre=o),o}),r(),t(8,"label",4),n(9,"ID Categor\xEDa"),r(),t(10,"input",6),g("ngModelChange",function(o){return p(e.categoriaId,o)||(e.categoriaId=o),o}),r(),t(11,"label",4),n(12,"Costo unitario"),r(),t(13,"input",7),g("ngModelChange",function(o){return p(e.costoUnitario,o)||(e.costoUnitario=o),o}),r(),t(14,"label",4),n(15,"Precio unitario"),r(),t(16,"input",8),g("ngModelChange",function(o){return p(e.precioUnitario,o)||(e.precioUnitario=o),o}),r(),t(17,"label",4),n(18,"Stock"),r(),t(19,"input",9),g("ngModelChange",function(o){return p(e.stock,o)||(e.stock=o),o}),r(),t(20,"div",10)(21,"button",11),s("click",function(){return e.cerrarModal()}),n(22,"Cancelar"),r(),t(23,"button",12),n(24),r()()()()),i&2&&(d(7),m("ngModel",e.nombre),d(3),m("ngModel",e.categoriaId),d(3),m("ngModel",e.costoUnitario),d(3),m("ngModel",e.precioUnitario),d(3),m("ngModel",e.stock),d(4),f("disabled",e.guardando),d(),b(" ",e.guardando?"Guardando...":"Guardar"," "))},dependencies:[M,I,O,x,A,k,V,B,w,L],styles:[".overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000059;-webkit-backdrop-filter:blur(6px);backdrop-filter:blur(6px);z-index:8000}.modal-card[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:min(450px,95%);background:#fff;border-radius:12px;padding:25px;box-shadow:0 12px 30px #00000040;z-index:9000;animation:_ngcontent-%COMP%_fadeIn .25s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translate(-50%,-58%)}to{opacity:1;transform:translate(-50%,-50%)}}"]})};var z=class c{productoId;cerrar=new N;productoService=h(U);cdr=h(W);nombre="";categoriaId=null;costoUnitario=null;precioUnitario=null;stock=null;stockOriginal=0;ngOnChanges(a){a.productoId&&this.productoId&&this.cargarProducto()}cargarProducto(){this.productoService.getProducto(this.productoId).subscribe({next:a=>{this.nombre=a.nombre,this.categoriaId=a.categoriaId??null,this.costoUnitario=a.costoUnitario,this.precioUnitario=a.precioUnitario,this.stock=a.stock??0,this.stockOriginal=this.stock,this.cdr.detectChanges()}})}guardar(){let a={nombre:this.nombre,categoriaId:this.categoriaId?Number(this.categoriaId):null,costoUnitario:Number(this.costoUnitario??0),precioUnitario:Number(this.precioUnitario??0)};this.stock!==null&&this.stock!==this.stockOriginal&&(a.stock=Number(this.stock)),this.productoService.updateProducto(this.productoId,a).subscribe({next:()=>{this.productoService.cargarProductos(),this.cerrar.emit()},error:i=>console.error("Error al editar:",i)})}cerrarModal(){this.cerrar.emit()}static \u0275fac=function(i){return new(i||c)};static \u0275cmp=P({type:c,selectors:[["app-editar"]],inputs:{productoId:"productoId"},outputs:{cerrar:"cerrar"},features:[j],decls:25,vars:5,consts:[[1,"overlay",3,"click"],[1,"modal-card"],[1,"text-center","mb-3"],[3,"ngSubmit"],[1,"form-label"],["type","text","name","nombre","required","",1,"form-control","mb-2",3,"ngModelChange","ngModel"],["type","number","name","categoriaId",1,"form-control","mb-2",3,"ngModelChange","ngModel"],["type","number","name","costoUnitario","required","",1,"form-control","mb-2",3,"ngModelChange","ngModel"],["type","number","name","precioUnitario","required","",1,"form-control","mb-2",3,"ngModelChange","ngModel"],["type","number","name","stock","min","0","required","",1,"form-control","mb-3",3,"ngModelChange","ngModel"],[1,"d-flex","justify-content-between","mt-3"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-primary"]],template:function(i,e){i&1&&(t(0,"div",0),s("click",function(){return e.cerrarModal()}),r(),t(1,"div",1)(2,"h3",2),n(3,"Editar producto"),r(),t(4,"form",3),s("ngSubmit",function(){return e.guardar()}),t(5,"label",4),n(6,"Nombre"),r(),t(7,"input",5),g("ngModelChange",function(o){return p(e.nombre,o)||(e.nombre=o),o}),r(),t(8,"label",4),n(9,"Categor\xEDa ID"),r(),t(10,"input",6),g("ngModelChange",function(o){return p(e.categoriaId,o)||(e.categoriaId=o),o}),r(),t(11,"label",4),n(12,"Costo unitario"),r(),t(13,"input",7),g("ngModelChange",function(o){return p(e.costoUnitario,o)||(e.costoUnitario=o),o}),r(),t(14,"label",4),n(15,"Precio unitario"),r(),t(16,"input",8),g("ngModelChange",function(o){return p(e.precioUnitario,o)||(e.precioUnitario=o),o}),r(),t(17,"label",4),n(18,"Stock"),r(),t(19,"input",9),g("ngModelChange",function(o){return p(e.stock,o)||(e.stock=o),o}),r(),t(20,"div",10)(21,"button",11),s("click",function(){return e.cerrarModal()}),n(22," Cancelar "),r(),t(23,"button",12),n(24," Guardar cambios "),r()()()()),i&2&&(d(7),m("ngModel",e.nombre),d(3),m("ngModel",e.categoriaId),d(3),m("ngModel",e.costoUnitario),d(3),m("ngModel",e.precioUnitario),d(3),m("ngModel",e.stock))},dependencies:[M,I,O,x,A,k,V,B,K,w,L],styles:[".overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000059;-webkit-backdrop-filter:blur(6px);backdrop-filter:blur(6px);z-index:8000}.modal-card[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:min(450px,95%);background:#fff;border-radius:12px;padding:25px;box-shadow:0 12px 30px #00000040;z-index:9000;animation:_ngcontent-%COMP%_fadeIn .25s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translate(-50%,-58%)}to{opacity:1;transform:translate(-50%,-50%)}}"]})};function ne(c,a){if(c&1){let i=E();t(0,"button",23),s("click",function(){C(i);let l=_().$implicit,o=_();return v(o.eliminar(l.id))}),n(1," \xD7 "),r()}}function ae(c,a){if(c&1){let i=E();t(0,"button",24),s("click",function(){C(i);let l=_().$implicit,o=_();return v(o.activarProducto(l.id))}),n(1," Activar "),r()}}function le(c,a){if(c&1){let i=E();t(0,"tr")(1,"td"),n(2),r(),t(3,"td"),n(4),r(),t(5,"td"),n(6),r(),t(7,"td"),n(8),r(),t(9,"td"),n(10),r(),t(11,"td"),n(12),S(13,"number"),r(),t(14,"td"),n(15),S(16,"number"),r(),t(17,"td")(18,"button",20),s("click",function(){let l=C(i).$implicit,o=_();return v(o.editar(l.id))}),n(19," Editar "),r(),D(20,ne,2,0,"button",21)(21,ae,2,0,"button",22),r()()}if(c&2){let i=a.$implicit;G("table-secondary",i.activo===!1),d(2),F(i.nombre),d(2),F((i.categoria==null?null:i.categoria.nombre)||"-"),d(2),F(i.stock),d(2),b("$",i.costoUnitario),d(2),b("$",i.precioUnitario),d(2),b("$",y(13,12,i.costoUnitario*(i.stock??0),"1.0-0")),d(3),b("$",y(16,15,i.precioUnitario*(i.stock??0),"1.0-0")),d(3),f("disabled",i.activo===!1),d(2),f("ngIf",i.activo!==!1),d(),f("ngIf",i.activo===!1)}}function de(c,a){if(c&1){let i=E();t(0,"app-agregar-producto",25),s("cerrar",function(){C(i);let l=_();return v(l.cerrarModal())}),r()}}function ce(c,a){if(c&1){let i=E();t(0,"app-editar",26),s("cerrar",function(){C(i);let l=_();return v(l.cerrarEditar())}),r()}if(c&2){let i=_();f("productoId",i.productoSeleccionadoId)}}var ie=class c{productoService=h(U);cdr=h(W);mostrarModal=!1;productos$=this.productoService.productos$;totalCosto=0;totalPrecio=0;busqueda="";productosOriginal=[];productosFiltradosList=[];mostrarEditar=!1;productoSeleccionadoId=null;hoy=new Date;ngOnInit(){this.productos$.subscribe(a=>{let i=a.filter(e=>e.activo!==!1);this.productosOriginal=[...a],this.productosFiltradosList=[...a],this.totalCosto=i.reduce((e,l)=>e+l.costoUnitario*(l.stock??0),0),this.totalPrecio=i.reduce((e,l)=>e+l.precioUnitario*(l.stock??0),0),this.cdr.markForCheck()}),this.productoService.cargarProductos()}eliminar(a){confirm("\xBFDesea eliminar este producto?")&&this.productoService.eliminarProducto(a).subscribe({next:()=>this.productoService.cargarProductos(),error:i=>console.error("Error al eliminar:",i)})}agregarNuevo(){this.mostrarModal=!0}cerrarModal(){this.mostrarModal=!1}editar(a){this.productoSeleccionadoId=a,this.mostrarEditar=!0}cerrarEditar(){this.mostrarEditar=!1,this.productoSeleccionadoId=null}descargarPDF(){let a=this.productosFiltradosList.filter(u=>u.activo!==!1),i=new X,e=new Image;e.src="assets/img/lisemma-logo.png",i.addImage(e,"PNG",80,5,50,20),i.setFontSize(18),i.text("Inventario de Productos",14,40),i.setFontSize(12),i.text(`Fecha: ${new Date().toLocaleDateString()}`,14,50);let l=a.reduce((u,T)=>u+T.costoUnitario*(T.stock??0),0),o=a.reduce((u,T)=>u+T.precioUnitario*(T.stock??0),0),oe=o-l;i.text(`Costo Total: $${l.toLocaleString()}`,14,60),i.text(`Precio Total: $${o.toLocaleString()}`,14,67),i.text(`Diferencia: $${oe.toLocaleString()}`,14,74),Z(i,{startY:85,head:[["Nombre","Categor\xEDa","Stock","Costo","Precio","Costo Inventario","Precio Inventario"]],body:a.map(u=>[u.nombre,u.categoria?.nombre||"-",u.stock??0,`$${u.costoUnitario}`,`$${u.precioUnitario}`,`$${u.costoUnitario*(u.stock??0)}`,`$${u.precioUnitario*(u.stock??0)}`]),styles:{fontSize:9}}),i.save("inventario.pdf")}actualizarFiltro(){let a=this.busqueda.trim().toLowerCase();if(!a){this.productosFiltradosList=[...this.productosOriginal];return}this.productosFiltradosList=this.productosOriginal.filter(i=>i.nombre?.toLowerCase().includes(a))}activarProducto(a){confirm("\xBFDesea activar este producto? El stock comenzar\xE1 en 0.")&&this.productoService.updateProducto(a,{activo:!0,stock:0}).subscribe({next:()=>{this.productoService.cargarProductos()},error:i=>console.error("Error al activar producto:",i)})}static \u0275fac=function(i){return new(i||c)};static \u0275cmp=P({type:c,selectors:[["app-productos"]],decls:66,vars:21,consts:[[1,"container","mt-4","mb-4"],[1,"text-center","text-muted"],[1,"text-center","titulo","mb-4"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"btn","btn-success",3,"click"],[1,"btn","btn-outline-danger",3,"click"],[1,"row","text-center","mb-4"],[1,"col-md-4"],[1,"card","shadow-sm","p-3","resumen-card"],[1,"resumen-numero"],[1,"card","shadow"],[1,"card-body"],[1,"mb-3"],["type","text","placeholder","Buscar por nombre...",1,"form-control",3,"ngModelChange","ngModel"],[1,"table-responsive",2,"max-height","450px","overflow-y","auto"],[1,"table","table-striped","table-hover","align-middle"],[1,"table-light","sticky-top"],[3,"table-secondary",4,"ngFor","ngForOf"],[3,"cerrar",4,"ngIf"],[3,"productoId","cerrar",4,"ngIf"],[1,"btn","btn-primary","btn-sm","me-1",3,"click","disabled"],["class","btn btn-danger btn-sm",3,"click",4,"ngIf"],["class","btn btn-success btn-sm",3,"click",4,"ngIf"],[1,"btn","btn-danger","btn-sm",3,"click"],[1,"btn","btn-success","btn-sm",3,"click"],[3,"cerrar"],[3,"cerrar","productoId"]],template:function(i,e){i&1&&($(0,"app-header"),t(1,"div",0)(2,"p",1),n(3),S(4,"date"),r(),t(5,"h2",2),n(6,"Inventario de Productos"),r(),t(7,"div",3)(8,"button",4),s("click",function(){return e.agregarNuevo()}),n(9,"+ Agregar Producto"),r(),t(10,"button",5),s("click",function(){return e.descargarPDF()}),n(11," Descargar PDF "),r()(),t(12,"div",6)(13,"div",7)(14,"div",8)(15,"h5"),n(16,"Costo total del inventario"),r(),t(17,"h3",9),n(18),S(19,"number"),r()()(),t(20,"div",7)(21,"div",8)(22,"h5"),n(23,"Precio total del inventario"),r(),t(24,"h3",9),n(25),S(26,"number"),r()()(),t(27,"div",7)(28,"div",8)(29,"h5"),n(30,"Diferencia"),r(),t(31,"h3",9),n(32),S(33,"number"),r()()()(),t(34,"div",10)(35,"div",11)(36,"h4",12),n(37,"Listado de productos"),r(),t(38,"div",12)(39,"input",13),g("ngModelChange",function(o){return p(e.busqueda,o)||(e.busqueda=o),o}),s("ngModelChange",function(){return e.actualizarFiltro()}),r()(),t(40,"p"),n(41),r(),t(42,"div",14)(43,"table",15)(44,"thead",16)(45,"tr")(46,"th"),n(47,"Nombre"),r(),t(48,"th"),n(49,"Categor\xEDa"),r(),t(50,"th"),n(51,"Stock"),r(),t(52,"th"),n(53,"Costo"),r(),t(54,"th"),n(55,"Precio"),r(),t(56,"th"),n(57,"Costo inventario"),r(),t(58,"th"),n(59,"Precio inventario"),r(),t(60,"th"),n(61,"Acciones"),r()()(),t(62,"tbody"),D(63,le,22,18,"tr",17),r()()()()()(),D(64,de,1,0,"app-agregar-producto",18)(65,ce,1,1,"app-editar",19)),i&2&&(d(3),b(" Fecha: ",y(4,9,e.hoy,"dd/MM/yyyy")," "),d(15),b("$",y(19,12,e.totalCosto,"1.0-0")),d(7),b("$",y(26,15,e.totalPrecio,"1.0-0")),d(7),b("$",y(33,18,e.totalPrecio-e.totalCosto,"1.0-0")),d(7),m("ngModel",e.busqueda),d(2),b("Filtrados: ",e.productosFiltradosList.length),d(22),f("ngForOf",e.productosFiltradosList),d(),f("ngIf",e.mostrarModal),d(),f("ngIf",e.mostrarEditar))},dependencies:[M,R,H,I,x,k,w,Q,q,z,J,Y],encapsulation:2})};export{ie as Productos};
